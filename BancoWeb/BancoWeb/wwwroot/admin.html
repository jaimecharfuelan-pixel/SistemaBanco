<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Panel Administrativo - Tu Banco</title>

    <!-- Estilos premium globales -->
    <link rel="stylesheet" href="styles/styles.css">

    <!-- Estilos adicionales del panel admin -->
    <style>

                /* -------------------------------------------
           PANEL ADMIN ‚Äî DISE√ëO PREMIUM COMPATIBLE
           Usa variables de styles.css (NO sobrescribe nada)
        -------------------------------------------- */

                /* === LAYOUT GENERAL === */
                .admin-wrapper {
                    display: flex;
                    gap: 25px;
                    padding: 30px;
                }

                /* === SIDEBAR === */
                .sidebar-premium {
                    width: 260px;
                    background: white;
                    padding: 25px 18px;
                    border-radius: var(--radius);
                    box-shadow: var(--shadow);
                    height: fit-content;
                    position: sticky;
                    top: 40px;
                }

                .menu-title {
                    font-weight: bold;
                    margin-bottom: 15px;
                    color: var(--color-text-dark);
                }

                .side-item {
                    padding: 12px;
                    border-radius: 14px;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    font-size: 16px;
                    transition: 0.25s;
                }

                    .side-item:hover {
                        background: rgba(0, 123, 255, .10);
                    }

                    .side-item.active {
                        background: var(--color-primary);
                        color: white;
                    }

                /* === PANEL PRINCIPAL === */
                .panel {
                    flex: 1;
                    padding: 35px;
                    background: white;
                    border-radius: var(--radius);
                    box-shadow: var(--shadow);
                    display: none;
                }

                    .panel.active {
                        display: block;
                    }

                .panel-title {
                    font-size: 24px;
                    font-weight: bold;
                    margin-bottom: 25px;
                }

                /* === TABLAS PREMIUM === */
                .admin-table {
                    width: 100%;
                    border-collapse: collapse;
                    background: white;
                    border-radius: var(--radius);
                    overflow: hidden;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
                }

                    .admin-table th {
                        background: #eef4ff;
                        padding: 14px;
                        font-size: 15px;
                        font-weight: 700;
                    }

                    .admin-table td {
                        padding: 12px 14px;
                        border-bottom: 1px solid #eee;
                    }

                    .admin-table tr:hover td {
                        background: #f7faff;
                    }

                /* === INPUTS POPUP === */
                .input-text {
                    width: 100%;
                    padding: 12px;
                    border-radius: var(--radius);
                    border: 1px solid #ccc;
                    margin-bottom: 12px;
                }

                /* === BOTONES === */
                .btn-primary {
                    background: var(--color-primary);
                    padding: 10px 18px;
                    color: white;
                    border-radius: 14px;
                    border: none;
                    cursor: pointer;
                    font-weight: bold;
                    transition: .25s;
                }

                    .btn-primary:hover {
                        background: var(--color-primary-hover);
                    }

                .btn-red {
                    background: #d9534f;
                    padding: 10px 18px;
                    color: white;
                    border-radius: 14px;
                    border: none;
                    cursor: pointer;
                    font-weight: bold;
                    transition: .25s;
                }

                    .btn-red:hover {
                        background: #c9302c;
                    }

                .btn-small {
                    padding: 6px 14px;
                    font-size: 14px;
                    border-radius: 10px;
                }

                /* === POPUPS === */
                .popup {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    display: none;
                    justify-content: center;
                    align-items: center;
                    background: rgba(0,0,0,0.45);
                    backdrop-filter: blur(3px);
                }

                .popup-content {
                    background: white;
                    padding: 30px;
                    border-radius: var(--radius);
                    width: 420px;
                    box-shadow: var(--shadow);
                    animation: fadeIn .25s ease-out;
                }

                @keyframes fadeIn {
                    from {
                        opacity: 0;
                        transform: scale(.92);
                    }

                    to {
                        opacity: 1;
                        transform: scale(1);
                    }
                }

                .popup-buttons {
                    display: flex;
                    justify-content: flex-end;
                    gap: 12px;
                    margin-top: 20px;
                }

                /* Centrado de contenido dentro del popup */
                #popupClienteData p,
                #detalleSucursal p {
                    margin: 6px 0;
                }
    </style>

</head>
















<body>

    <!-- NAV SUPERIOR -->
    <header class="nav">
        <div class="nav-left">
            <img src="resources/icono.webp" class="nav-logo" />
            <span class="nav-title">Panel Administrativo</span>
        </div>
        <a href="login.html" class="nav-btn">Cerrar sesi√≥n</a>
    </header>

    <div class="admin-wrapper">

        <!-- SIDEBAR -->
        <aside class="sidebar-premium">
            <div class="menu-title">Men√∫</div>

            <div class="side-item active" data-target="solicitudes">
                üìÑ Solicitudes
            </div>

            <div class="side-item" data-target="sucursales">
                üè¢ Sucursales
            </div>

            <div class="side-item" data-target="cajeros">
                üèß Cajeros
            </div>
        </aside>


        <!-- PANEL DE SOLICITUDES -->
        <section id="solicitudes" class="panel active">
            <h2 class="panel-title">Solicitudes de cuentas</h2>

            <table class="admin-table" id="tablaSolicitudes">
                <tr>
                    <th>Nombre</th>
                    <th>C√©dula</th>
                    <th>Acci√≥n</th>
                </tr>
            </table>
        </section>


        <!-- PANEL DE SUCURSALES -->
        <section id="sucursales" class="panel">
            <h2 class="panel-title">Sucursales</h2>

            <button class="btn-primary" style="margin-bottom:20px;" onclick="abrirCrearSucursal()">‚ûï Crear sucursal</button>

            <table class="admin-table" id="tablaSucursales">
                <tr><th>Nombre</th><th>Estado</th></tr>
            </table>
        </section>


        <!-- PANEL DE CAJEROS -->
        <section id="cajeros" class="panel">
            <h2 class="panel-title">Cajeros</h2>

            <button class="btn-primary">‚ûï Crear cajero</button>

            <table class="admin-table" id="tablaCajeros">
                <tr><th>Nombre</th><th>Estado</th><th>Acci√≥n</th></tr>
            </table>
        </section>


    </div>

    <!-- POPUP CREAR SUCURSAL -->
    <div id="popupCrearSucursal" class="popup">
        <div class="popup-content">

            <h3>Crear sucursal</h3>

            <input class="input-text" id="nuevaNombre" placeholder="Nombre">
            <input class="input-text" id="nuevaDireccion" placeholder="Direcci√≥n">
            <input class="input-text" id="nuevaTelefono" placeholder="Tel√©fono">

            <div class="popup-buttons">
                <button class="btn-primary" onclick="crearSucursal()">Crear</button>
                <button class="btn-red" onclick="cerrarCrearSucursal()">Cancelar</button>
            </div>

        </div>
    </div>


    <!-- POPUP DETALLE SUCURSAL -->
    <div id="popupDetalleSucursal" class="popup">
        <div class="popup-content">

            <h3>Detalles de sucursal</h3>
            <div id="detalleSucursal"></div>

            <div class="popup-buttons">
                <button class="btn-primary" onclick="toggleEstadoSucursal()">Cambiar estado</button>
                <button class="btn-red" onclick="abrirEliminarSucursal()">Eliminar</button>
            </div>

            <div style="margin-top:10px; text-align:right;">
                <button class="btn-primary" onclick="cerrarDetalleSucursal()">Cerrar</button>
            </div>

        </div>
    </div>


    <!-- POPUP ELIMINAR SUCURSAL -->
    <div id="popupEliminarSucursal" class="popup">
        <div class="popup-content">
            <h3>¬øEliminar sucursal?</h3>

            <div class="popup-buttons">
                <button class="btn-red" onclick="confirmarEliminarSucursal()">S√≠</button>
                <button class="btn-primary" onclick="cerrarEliminarSucursal()">Cancelar</button>
            </div>
        </div>
    </div>


    <!-- POPUP VER SOLICITUD DEL CLIENTE -->
    <div id="popupCliente" class="popup">
        <div class="popup-content">

            <h3>Solicitud del cliente</h3>

            <div id="popupClienteData" style="margin-bottom: 15px;">
                <!-- Aqu√≠ se cargar√°n los datos del cliente -->
            </div>

            <div class="popup-buttons">
                <button class="btn-primary" onclick="crearCuenta()">Crear cuenta</button>
                <button class="btn-red" onclick="cerrarPopupCliente()">Cerrar</button>
            </div>

        </div>
    </div>


















    <script>

        // =============================================================
        // 1. NAV / TABS
        // =============================================================
        function initTabs() {
            const items = document.querySelectorAll('.side-item');

            items.forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelector('.side-item.active')?.classList.remove('active');
                    btn.classList.add('active');

                    document.querySelector('.panel.active')?.classList.remove('active');
                    document.getElementById(btn.dataset.target).classList.add('active');
                });
            });
        }
        initTabs();


        // =============================================================
        // 2. SUCURSALES ‚Äî RUTAS REALES
        // =============================================================
        const API_SUCURSAL = "https://localhost:7251/api/sucursal";

        let sucursalSeleccionada = null;
        let sucursalEliminarId = null;
        let estadoActual = null;


        // ============================
        // LISTAR SUCURSALES
        // ============================
        async function cargarSucursales() {

            const res = await fetch(`${API_SUCURSAL}/listar`);
            const data = await res.json();

            const tabla = document.getElementById("tablaSucursales");
            tabla.innerHTML = `
                <tr><th>Nombre</th><th>Estado</th></tr>
            `;

            data.forEach(s => {
                tabla.innerHTML += `
                    <tr>
                        <td onclick="verDetalleSucursal(${s.idSucursal})"
                            style="cursor:pointer;color:#2563eb;font-weight:600;">
                            ${s.nombreSucursal}
                        </td>
                        <td>${s.estadoSucursal}</td>
                    </tr>
                `;
            });
        }

        cargarSucursales();


        // ============================
        // DETALLES SUCURSAL
        // ============================
        async function verDetalleSucursal(id) {
            sucursalSeleccionada = id;

            const res = await fetch(`${API_SUCURSAL}/listar`);
            const lista = await res.json();

            const suc = lista.find(x => x.idSucursal === id);

            estadoActual = suc.estadoSucursal.toLowerCase();

            document.getElementById("detalleSucursal").innerHTML = `
                <p><strong>Nombre:</strong> ${suc.nombreSucursal}</p>
                <p><strong>Direcci√≥n:</strong> ${suc.direccionSucursal}</p>
                <p><strong>Tel√©fono:</strong> ${suc.telefonoSucursal}</p>
                <p><strong>Estado:</strong> ${suc.estadoSucursal}</p>
            `;

            document.getElementById("popupDetalleSucursal").style.display = "flex";
        }

        function cerrarDetalleSucursal() {
            document.getElementById("popupDetalleSucursal").style.display = "none";
        }


        // ============================
        // CAMBIAR ESTADO
        // ============================
        async function toggleEstadoSucursal() {

            const nuevoEstado = (estadoActual === "abierta") ? "cerrada" : "abierta";

            const body = {
                idSucursal: sucursalSeleccionada,
                estado: nuevoEstado
            };

            const res = await fetch(`${API_SUCURSAL}/editar-estado`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body)
            });

            if (!res.ok) {
                const err = await res.json();
                alert("Error cambiando estado: " + err.error);
                return;
            }

            alert("‚úî Estado actualizado");
            cerrarDetalleSucursal();
            cargarSucursales();
        }


        // ============================
        // POPUP ELIMINAR
        // ============================
        function abrirEliminarSucursal() {
            sucursalEliminarId = sucursalSeleccionada;
            document.getElementById("popupEliminarSucursal").style.display = "flex";
        }

        function cerrarEliminarSucursal() {
            document.getElementById("popupEliminarSucursal").style.display = "none";
        }

        async function confirmarEliminarSucursal() {
            const res = await fetch(`${API_SUCURSAL}/eliminar/${sucursalEliminarId}`, {
                method: "DELETE"
            });

            if (!res.ok) {
                alert("Error eliminando sucursal");
                return;
            }

            alert("‚úî Sucursal eliminada");
            cerrarEliminarSucursal();
            cargarSucursales();
        }



        // =============================================================
        // 3. CREAR SUCURSAL
        // =============================================================
        function abrirCrearSucursal() {
            document.getElementById("popupCrearSucursal").style.display = "flex";
        }

        function cerrarCrearSucursal() {
            document.getElementById("popupCrearSucursal").style.display = "none";
        }

        async function crearSucursal() {

            const nombre = document.getElementById("nuevaNombre").value.trim();
            const direccion = document.getElementById("nuevaDireccion").value.trim();
            const telefono = document.getElementById("nuevaTelefono").value.trim();

            if (!nombre || !direccion || !telefono) {
                alert("Todos los campos son obligatorios.");
                return;
            }

            const admin = JSON.parse(localStorage.getItem("usuario"));
            const idAdmin = admin?.id ?? 1;

            const body = {
                nombreSucursal: nombre,
                direccionSucursal: direccion,
                telefonoSucursal: telefono,
                idAdministrador: idAdmin
            };

            const res = await fetch(`${API_SUCURSAL}/crear`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body)
            });

            if (!res.ok) {
                const err = await res.json();
                alert("Error creando sucursal: " + err.error);
                return;
            }

            alert("‚úî Sucursal creada correctamente");
            cerrarCrearSucursal();
            cargarSucursales();
        }

















        // =============================================================
        // 3. CLIENTES / SOLICITUDES
        // =============================================================

        // üü¶ CORREGIDO ‚Üí EL PUERTO ES 7251
        const API_CLIENTES = "https://localhost:7251/api/admin";

        let selectedCliente = null;


        // ============================
        // LISTAR SOLICITUDES
        // ============================
        async function cargarSolicitudes() {
            try {

                const res = await fetch(`${API_CLIENTES}/solicitudes`);
                if (!res.ok) {
                    console.error("Error al consultar solicitudes:", res.status);
                    return;
                }

                const data = await res.json();

                const tabla = document.querySelector("#tablaSolicitudes");

                tabla.innerHTML = `
                <tr>
                    <th>Nombre</th>
                    <th>C√©dula</th>
                    <th>Acci√≥n</th>
                </tr>
            `;

                data.forEach(c => {
                    tabla.innerHTML += `
                    <tr>
                        <td>${c.nombre}</td>
                        <td>${c.cedula}</td>
                        <td>
                            <button class="btn-primary btn-small"
                                onclick="abrirPopupCliente('${c.idCliente}', '${c.nombre}', '${c.cedula}', '${c.telefono}', '${c.email}')">
                                Ver solicitud
                            </button>

                        </td>
                    </tr>
                `;
                });

            } catch (e) {
                console.error("Error cargando solicitudes:", e);
            }
        }

        // Ejecutar SIEMPRE cuando carga la p√°gina
        cargarSolicitudes();


        // ============================
        // POPUP CLIENTE
        // ============================
        function abrirPopupCliente(id, nombre, cedula, telefono, email) {

            selectedCliente = id;

            document.getElementById("popupCliente").style.display = "flex";

            document.getElementById("popupClienteData").innerHTML = `
        <p><strong>ID Cliente:</strong> ${id}</p>
        <p><strong>Nombre:</strong> ${nombre}</p>
        <p><strong>C√©dula:</strong> ${cedula}</p>
        <p><strong>Tel√©fono:</strong> ${telefono}</p>
        <p><strong>Email:</strong> ${email}</p>
        `;
        }


        function cerrarPopupCliente() {
            document.getElementById("popupCliente").style.display = "none";
        }



        // ============================
        // CREAR CUENTA
        // ============================
        async function crearCuenta() {

            if (!selectedCliente) {
                alert("No hay cliente seleccionado.");
                return;
            }

            const admin = JSON.parse(localStorage.getItem("usuario"));
            const idAdmin = admin?.id ?? 1;

            const body = {
                idCliente: selectedCliente,
                idAdministrador: idAdmin
            };

            const res = await fetch(`${API_CLIENTES}/crear-cuenta`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body)
            });

            if (!res.ok) {
                const error = await res.text();
                alert("Error al crear cuenta: " + error);
                return;
            }

            alert("‚úî Cuenta creada correctamente");

            cerrarPopupCliente();
            cargarSolicitudes(); // üî• Se vuelve a cargar la lista
        }

    </script>

</body>
</html>
